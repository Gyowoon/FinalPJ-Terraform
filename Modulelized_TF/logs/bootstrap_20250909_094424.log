== Bootstrap started Tue, Sep  9, 2025  9:44:24 AM ==

==================== Running terraform apply =====================
[0m[1mInitializing the backend...[0m
[0m[1mUpgrading modules...[0m
- bastion in modules\BASTION
- dns in modules\DNS
- eks in modules\EKS
- rds in modules\RDS
- redis in modules\REDIS
- vpc in modules\VPC
[0m[1mInitializing provider plugins...[0m
- Finding hashicorp/aws versions matching "~> 5.0"...
- Finding hashicorp/kubernetes versions matching "~> 2.23"...
- Installing hashicorp/aws v5.100.0...
- Installed hashicorp/aws v5.100.0 (signed by HashiCorp)
- Installing hashicorp/kubernetes v2.38.0...
- Installed hashicorp/kubernetes v2.38.0 (signed by HashiCorp)
Terraform has made some changes to the provider dependency selections recorded
in the .terraform.lock.hcl file. Review those changes and commit them to your
version control system if they represent changes you intended to make.

[0m[1m[32mTerraform has been successfully initialized![0m[32m[0m
[0m[32m
You may now begin working with Terraform. Try running "terraform plan" to see
any changes that are required for your infrastructure. All Terraform commands
should now work.

If you ever set or change modules or backend configuration for Terraform,
rerun this command to reinitialize your working directory. If you forget, other
commands will detect it and remind you to do so if necessary.[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on main-bastion-setting.tf line 56, in resource "aws_eks_access_entry" "bastion":
[31m│[0m [0m  56:   cluster_name      = [4maws_eks_cluster.eks[0m.name[0m
[31m│[0m [0m
[31m│[0m [0mA managed resource "aws_eks_cluster" "eks" has not been declared in the
[31m│[0m [0mroot module.
[31m│[0m [0m
[31m│[0m [0mDid you mean the data resource data.aws_eks_cluster.eks?
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on main-root.tf line 143, in resource "aws_instance" "bastion":
[31m│[0m [0m 143:   ami                         = [4mdata.aws_ami.bastion[0m.id[0m
[31m│[0m [0m
[31m│[0m [0mA data resource "aws_ami" "bastion" has not been declared in the root
[31m│[0m [0mmodule.
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on main-root.tf line 148, in resource "aws_instance" "bastion":
[31m│[0m [0m 148:     [4maws_eks_cluster.eks[0m.vpc_config[0].cluster_security_group_id # ← EKS가 자동 생성한 SG 참조[0m
[31m│[0m [0m
[31m│[0m [0mA managed resource "aws_eks_cluster" "eks" has not been declared in the
[31m│[0m [0mroot module.
[31m│[0m [0m
[31m│[0m [0mDid you mean the data resource data.aws_eks_cluster.eks?
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on main-root.tf line 225, in resource "aws_instance" "bastion":
[31m│[0m [0m 225:   depends_on = [[4maws_eks_cluster.eks[0m] # EKS Cluster 생성 이후 Bastion이 생성되게 의존성 추가 [0m
[31m│[0m [0m
[31m│[0m [0mA managed resource "aws_eks_cluster" "eks" has not been declared in the
[31m│[0m [0mroot module.
[31m│[0m [0m
[31m│[0m [0mDid you mean the data resource data.aws_eks_cluster.eks?
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on main-root.tf line 278, in resource "aws_db_subnet_group" "db":
[31m│[0m [0m 278:   subnet_ids = [[4maws_subnet.private1[0m.id, aws_subnet.private2.id][0m
[31m│[0m [0m
[31m│[0m [0mA managed resource "aws_subnet" "private1" has not been declared in the
[31m│[0m [0mroot module.
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on main-root.tf line 278, in resource "aws_db_subnet_group" "db":
[31m│[0m [0m 278:   subnet_ids = [aws_subnet.private1.id, [4maws_subnet.private2[0m.id][0m
[31m│[0m [0m
[31m│[0m [0mA managed resource "aws_subnet" "private2" has not been declared in the
[31m│[0m [0mroot module.
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on outputs.tf line 2, in output "vpc_id":
[31m│[0m [0m   2:   value = [4maws_vpc.main[0m.id[0m
[31m│[0m [0m
[31m│[0m [0mA managed resource "aws_vpc" "main" has not been declared in the root
[31m│[0m [0mmodule.
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on outputs.tf line 6, in output "cluster_endpoint":
[31m│[0m [0m   6:   value = [4maws_eks_cluster.eks[0m.endpoint[0m
[31m│[0m [0m
[31m│[0m [0mA managed resource "aws_eks_cluster" "eks" has not been declared in the
[31m│[0m [0mroot module.
[31m│[0m [0m
[31m│[0m [0mDid you mean the data resource data.aws_eks_cluster.eks?
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on outputs.tf line 10, in output "cluster_name":
[31m│[0m [0m  10:   value = [4maws_eks_cluster.eks[0m.name[0m
[31m│[0m [0m
[31m│[0m [0mA managed resource "aws_eks_cluster" "eks" has not been declared in the
[31m│[0m [0mroot module.
[31m│[0m [0m
[31m│[0m [0mDid you mean the data resource data.aws_eks_cluster.eks?
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on outputs.tf line 14, in output "shopping_mall_service_account":
[31m│[0m [0m  14:   value = [4mkubernetes_service_account.shopping_mall[0m.metadata[0].name[0m
[31m│[0m [0m
[31m│[0m [0mA managed resource "kubernetes_service_account" "shopping_mall" has not
[31m│[0m [0mbeen declared in the root module.
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on outputs.tf line 18, in output "shopping_mall_role_arn":
[31m│[0m [0m  18:   value = [4maws_iam_role.shopping_mall_role[0m.arn[0m
[31m│[0m [0m
[31m│[0m [0mA managed resource "aws_iam_role" "shopping_mall_role" has not been
[31m│[0m [0mdeclared in the root module.
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on outputs.tf line 22, in output "pod_identity_association_id":
[31m│[0m [0m  22:   value = [4maws_eks_pod_identity_association.shopping_mall[0m.association_id[0m
[31m│[0m [0m
[31m│[0m [0mA managed resource "aws_eks_pod_identity_association" "shopping_mall" has
[31m│[0m [0mnot been declared in the root module.
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mReference to undeclared resource[0m
[31m│[0m [0m
[31m│[0m [0m[0m  on outputs.tf line 39, in output "redis_endpoint":
[31m│[0m [0m  39:   value       = [4maws_elasticache_cluster.redis[0m.cache_nodes[0].address[0m
[31m│[0m [0m
[31m│[0m [0mA managed resource "aws_elasticache_cluster" "redis" has not been declared
[31m│[0m [0min the root module.
[31m╵[0m[0m
[31m╷[0m[0m
[31m│[0m [0m[1m[31mError: [0m[0m[1mexpected type to be one of ["EC2" "EC2_LINUX" "EC2_WINDOWS" "FARGATE_LINUX" "HYBRID_LINUX" "STANDARD"], got IAM[0m
[31m│[0m [0m
[31m│[0m [0m[0m  with module.bastion.aws_eks_access_entry.bastion,
[31m│[0m [0m  on modules\BASTION\main.tf line 171, in resource "aws_eks_access_entry" "bastion":
[31m│[0m [0m 171:   type             = [4m"IAM"[0m[0m
[31m│[0m [0m
[31m╵[0m[0m

❌ ERROR: line 147 while running: terraform -chdir="$TF_DIR" apply -auto-approve (exit=1)
👉 Full log: ./logs/bootstrap_20250909_094424.log
Dropping you into interactive shell (type: exit to quit)
